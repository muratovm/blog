{{ define "main" }}
{{ $posts := where site.RegularPages "Section" "blog" }}
{{ $postsByDate := $posts.ByDate.Reverse }}
{{ $featured := first 1 $postsByDate }}

{{ $startSlugs := .Params.start_here }}
{{ if not $startSlugs }}
{{ $startSlugs = slice "how-this-blog-works" "binary-search-python" "toy-car-ml" }}
{{ end }}
{{ $startPages := slice }}
{{ range $startSlugs }}
{{ $matches := where $posts "Params.slug" . }}
{{ if gt (len $matches) 0 }}
{{ $startPages = $startPages | append (index $matches 0) }}
{{ end }}
{{ end }}

{{ $guides := slice }}
{{ $builds := slice }}
{{ $notes := slice }}
{{ range $postsByDate }}
{{ $path := lower .File.Path }}
{{ if in $path "blog/[guides]/" }}
{{ $guides = $guides | append . }}
{{ else if in $path "blog/[builds]/" }}
{{ $builds = $builds | append . }}
{{ else if in $path "blog/[notes]/" }}
{{ $notes = $notes | append . }}
{{ end }}
{{ end }}

<main class="home-layout">


  <section class="home-featured">
    <div class="home-section-head">
      <h3>Latest Feature</h3>
      <a href="{{ "blog/" | relURL }}">Browse all posts</a>
    </div>
    {{ range $featured }}
    {{ $page := . }}
    <article class="home-featured-card">
      {{ $featureImg := .Resources.GetMatch .Params.image }}
      {{ if not $featureImg }}
      {{ $featureImg = resources.Get (printf "banners/%s" .Params.image) }}
      {{ end }}
      {{ if and $featureImg (eq $featureImg.ResourceType "image") }}
      {{ $featureImg = $featureImg.Fill "1200x675 smart webp q82" }}
      {{ end }}
      {{ with $featureImg }}
      <a href="{{ $page.RelPermalink }}">
        <img src="{{ .RelPermalink }}" width="{{ .Width }}" height="{{ .Height }}" loading="lazy"
          alt="{{ $page.Title }}">
      </a>
      {{ end }}
      <div class="home-featured-body">
        <p class="home-meta">{{ .Date.Format "Jan 2, 2006" }} Â· {{ .ReadingTime }} min read</p>
        <h4><a href="{{ .RelPermalink }}">{{ .Title }}</a></h4>
        <p>{{ .Description }}</p>
      </div>
    </article>
    {{ end }}
  </section>

  <section class="home-start-here">
    <div class="home-section-head">
      <h3>ðŸ“Œ Pinned</h3>
    </div>
    <div class="home-grid home-grid-3">
      {{ range $startPages }}
      {{ $page := . }}
      <article class="home-card">
        {{ $cardImg := .Resources.GetMatch .Params.image }}
        {{ if not $cardImg }}
        {{ $cardImg = resources.Get (printf "banners/%s" .Params.image) }}
        {{ end }}
        {{ if and $cardImg (eq $cardImg.ResourceType "image") }}
        {{ $cardImg = $cardImg.Fill "720x405 smart webp q80" }}
        {{ end }}
        {{ with $cardImg }}
        <a href="{{ $page.RelPermalink }}">
          <img src="{{ .RelPermalink }}" width="{{ .Width }}" height="{{ .Height }}" loading="lazy"
            alt="{{ $page.Title }}">
        </a>
        {{ end }}
        <h4><a href="{{ .RelPermalink }}">{{ .Title }}</a></h4>
        <p>{{ .Description }}</p>
      </article>
      {{ end }}
    </div>
  </section>

  <section class="home-tracks">
    <div class="home-section-head">
      <h3>Explore by Track</h3>
    </div>
    <div class="home-grid home-grid-1">
      <article class="home-track">
        <div class="home-track-head">
          <h4>Builds</h4>
          <a href="{{ "blog/builds/" | relURL }}">View all</a>
        </div>
        <ul>
          {{ range first 3 $builds }}
          <li><a href="{{ .RelPermalink }}">{{ .Title }}</a><span>{{ .Date.Format "Jan 2" }}</span></li>
          {{ end }}
        </ul>
      </article>

      <article class="home-track">
        <div class="home-track-head">
          <h4>Guides</h4>
          <a href="{{ "blog/guides/" | relURL }}">View all</a>
        </div>
        <ul>
          {{ range first 3 $guides }}
          <li><a href="{{ .RelPermalink }}">{{ .Title }}</a><span>{{ .Date.Format "Jan 2" }}</span></li>
          {{ end }}
        </ul>
      </article>

      <article class="home-track">
        <div class="home-track-head">
          <h4>Notes</h4>
          <a href="{{ "blog/notes/" | relURL }}">View all</a>
        </div>
        <ul>
          {{ range first 3 $notes }}
          <li><a href="{{ .RelPermalink }}">{{ .Title }}</a><span>{{ .Date.Format "Jan 2" }}</span></li>
          {{ end }}
        </ul>
      </article>
    </div>
  </section>

  <section class="home-recent">
    <div class="home-section-head">
      <h3>Recent Activity</h3>
    </div>
    <ul class="home-recent-list">
      {{ range first 6 $postsByDate }}
      <li>
        <span>{{ .Date.Format "Jan 2, 2006" }}</span>
        <a href="{{ .RelPermalink }}">{{ .Title }}</a>
        <em>{{ .ReadingTime }} min read</em>
      </li>
      {{ end }}
    </ul>
  </section>
</main>
{{ end }}
