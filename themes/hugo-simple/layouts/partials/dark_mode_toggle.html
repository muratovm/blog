<button id="theme-toggle" type="button" aria-label="Toggle dark mode">‚òÄÔ∏è</button>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const themeToggle = document.getElementById('theme-toggle');
        const body = document.body;

        function set_toggle_properties(body, themeToggle) {
            const styles = getComputedStyle(body);
            themeToggle.textContent = body.classList.contains('dark-mode') ? 'üåô' : '‚òÄÔ∏è';
            themeToggle.style.color = styles.getPropertyValue('--text').trim();
            themeToggle.style.backgroundColor = styles.getPropertyValue('--bg').trim();
            themeToggle.style.borderColor = styles.getPropertyValue('--border').trim();
        }

        themeToggle.addEventListener('click', () => {
            body.classList.toggle('dark-mode');
            set_toggle_properties(body, themeToggle);
            const newTheme = body.classList.contains('dark-mode') ? 'dark-mode' : 'light-mode';
            localStorage.setItem('theme', newTheme);
        });

        // Apply saved or system theme
        const currentTheme = localStorage.getItem('theme');
        if (currentTheme == 'dark-mode') {
            body.classList.add('dark-mode');
            localStorage.setItem('theme', "dark-mode");
        }
        else if (!currentTheme && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            body.classList.add('dark-mode');
            localStorage.setItem('theme', "dark-mode");
        }
        else{
            localStorage.setItem('theme', "light-mode");
        }

        let current_mode = body.classList.contains('dark-mode') ? 'dark-mode' : 'light-mode'

        set_toggle_properties(body, themeToggle);
        console.log('DOM fully loaded and parsed');
        console.log("Likes Dark Theme: " + window.matchMedia('(prefers-color-scheme: dark)').matches);
        console.log("Current Theme: " + current_mode);
        console.log("Stored Theme: " + currentTheme);
    });

    window.addEventListener('pageshow', (event) => {

        const currentTheme = localStorage.getItem('theme');
        const body = document.body;
        const themeToggle = document.getElementById('theme-toggle');

        function set_toggle_properties(body, themeToggle) {
            const styles = getComputedStyle(body);
            themeToggle.textContent = body.classList.contains('dark-mode') ? 'üåô' : '‚òÄÔ∏è';
            themeToggle.style.color = styles.getPropertyValue('--text').trim();
            themeToggle.style.backgroundColor = styles.getPropertyValue('--bg').trim();
            themeToggle.style.borderColor = styles.getPropertyValue('--border').trim();
        }

        if (currentTheme == 'dark-mode') {
            body.classList.add('dark-mode');
        } else {
            body.classList.remove('dark-mode');
        }

        // Update button appearance
        set_toggle_properties(body, themeToggle);


        let current_mode = body.classList.contains('dark-mode') ? 'dark-mode' : 'light-mode'
        console.log('Page view event triggered');
        console.log("Likes Dark Theme: " + window.matchMedia('(prefers-color-scheme: dark)').matches);
        console.log("Current Theme: " + current_mode);
        console.log("Stored Theme: " + currentTheme);

    });
</script>
