<textarea id="shaderEditor" width="100%" rows="10" cols="60" color="white" style="width: 100%; height: 500px; font-family: monospace; font-size: 0.82rem; background-color: #222; color: #fff; border: none; padding: 10px; resize: vertical;">
    {{ .Inner | safeHTML }}
</textarea>

<style>
    .grid-container {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.9rem;
      padding: 0.9rem;
      border: 1px solid var(--border);
      border-radius: var(--standard-border-radius);
      background: var(--accent-bg);
      margin: 0.8rem 0;
    }

    .slider-block {
      display: flex;
      flex-direction: column;
      align-items: start;
      gap: 0.35rem;
      padding: 0.5rem 0.6rem;
      border: 1px dashed color-mix(in srgb, var(--border) 75%, transparent);
      border-radius: var(--standard-border-radius);
      background: color-mix(in srgb, var(--accent-bg) 92%, var(--bg));
    }

    .slider-block input[type="range"] {
      width: 100%;
      appearance: none;
      -webkit-appearance: none;
      background: transparent;
      margin: 0.1rem 0 0;
    }

    .label-row {
      display: flex;
      justify-content: space-between;
      width: 100%;
      align-items: baseline;
      gap: 0.5rem;
    }

    .label-row h4 {
      margin: 0;
      font-size: 0.95rem;
      font-weight: 600;
      color: var(--text);
    }

    .slider-block span {
      font-size: 0.86rem;
      color: var(--text-light);
    }

    .slider-block input[type="range"]::-webkit-slider-runnable-track {
      height: 0.4rem;
      border-radius: 999px;
      background: color-mix(in srgb, var(--accent) 28%, var(--accent-bg));
      border: 1px solid color-mix(in srgb, var(--border) 85%, transparent);
    }

    .slider-block input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 0.95rem;
      height: 0.95rem;
      margin-top: -0.33rem;
      border-radius: 50%;
      background: var(--accent);
      border: 1px solid var(--accent-hover);
      box-shadow: 0 0 0 2px var(--accent-bg);
      cursor: pointer;
    }

    .slider-block input[type="range"]::-moz-range-track {
      height: 0.4rem;
      border-radius: 999px;
      background: color-mix(in srgb, var(--accent) 28%, var(--accent-bg));
      border: 1px solid color-mix(in srgb, var(--border) 85%, transparent);
    }

    .slider-block input[type="range"]::-moz-range-thumb {
      width: 0.95rem;
      height: 0.95rem;
      border-radius: 50%;
      background: var(--accent);
      border: 1px solid var(--accent-hover);
      box-shadow: 0 0 0 2px var(--accent-bg);
      cursor: pointer;
    }

    .slider-block input[type="range"]:focus-visible {
      outline: none;
    }

    .slider-block input[type="range"]:focus-visible::-webkit-slider-thumb {
      box-shadow: 0 0 0 2px var(--accent-bg), 0 0 0 4px color-mix(in srgb, var(--accent) 35%, transparent);
    }

    .slider-block input[type="range"]:focus-visible::-moz-range-thumb {
      box-shadow: 0 0 0 2px var(--accent-bg), 0 0 0 4px color-mix(in srgb, var(--accent) 35%, transparent);
    }

    @media (max-width: 720px) {
      .grid-container {
        grid-template-columns: 1fr;
      }
    }
  </style>


<!--4 by 2 grid of ranges-->

<div class="grid-container">
  <!-- 8 identical sliders -->
  <div class="slider-block">
    <div class="label-row">
        <h4>Width</h4>
    </div>
    <input type="range" min="0.1" max="0.9" step="0.1" value="0.1" id="widthSlider" style="width:50%;">
    <span id="widthValue">0.1</span>
  </div>
  <div class="slider-block">
    <div class="label-row">
        <h4>Distance</h4>
    </div>
    <input type="range" min="0.1" max="0.9" step="0.1" value="0.5" id="distanceSlider" style="width:50%;">
    <span id="distanceValue">0.5</span>
  </div>
  <div class="slider-block">
    <div class="label-row">
        <h4>Blur</h4>
    </div>
    <input type="range" min="0.1" max="0.9" step="0.1" value="0.7" id="blurSlider" style="width:50%;">
    <span id="blurValue">0.7</span>
  </div>
  <div class="slider-block">
    <div class="label-row">
        <h4>Repetition</h4>
    </div>
    <input type="range" min="0.1" max="0.9" step="0.1" value="1.0" id="repetitionSlider" style="width:50%;">
    <span id="repetitionValue">1.0</span>
  </div>
  <div class="slider-block">
    <div class="label-row">
        <h4>Multiply</h4>
    </div>
    <input type="range" min="0.1" max="0.9" step="0.1" value="0.15" id="multiplySlider" style="width:50%;">
    <span id="multiplyValue">0.15</span>
  </div>
  <div class="slider-block">
    <div class="label-row">
        <h4>Exponent</h4>
    </div>
    <input type="range" min="1" max="10" step="1" value="1" id="exponentSlider" style="width:50%;">
    <span id="exponentValue">1</span>
  </div>
  <div class="slider-block">
    <div class="label-row">
        <h4>Points</h4>
    </div>
    <input type="range" min="0" max="10" step="1" value="5" id="pointsSlider" style="width:50%;">
    <span id="pointsValue">5</span>
  </div>
</div>



<canvas id="shaderCanvas" style="display:block; width:100%; height:500px;"></canvas>
<noscript>
  <p>This interactive shader demo requires JavaScript. The GLSL source code is shown above.</p>
</noscript>

<script>
const canvas = document.getElementById("shaderCanvas");
const editor = document.getElementById("shaderEditor");

const widthSlider = document.getElementById("widthSlider");
const distanceSlider = document.getElementById("distanceSlider");
const blurSlider = document.getElementById("blurSlider");
const repetitionSlider = document.getElementById("repetitionSlider");
const multiplySlider = document.getElementById("multiplySlider");
const exponentSlider = document.getElementById("exponentSlider");
const pointsSlider = document.getElementById("pointsSlider");

const widthValue = document.getElementById("widthValue");
const distanceValue = document.getElementById("distanceValue");
const blurValue = document.getElementById("blurValue");
const repetitionValue = document.getElementById("repetitionValue");
const multiplyValue = document.getElementById("multiplyValue");
const exponentValue = document.getElementById("exponentValue");
const pointsValue = document.getElementById("pointsValue");

if (!window.GlslCanvas) {
  console.error("GlslCanvas failed to load. Check CDN/network access.");
  canvas.outerHTML = '<p>Interactive shader preview is unavailable right now. The GLSL source code is still available above.</p>';
} else {
  const sandbox = new GlslCanvas(canvas);

function resizeCanvasToCSSSize() {
    const displayWidth = canvas.clientWidth;
    const displayHeight = canvas.clientHeight;

    // Only update if size changed
    if (canvas.width !== displayWidth || canvas.height !== displayHeight) {
      canvas.width = displayWidth;
      canvas.height = displayHeight;
    }
  }

// Resize initially and on window resize
resizeCanvasToCSSSize();
sandbox.load(editor.value);
editor.addEventListener("input", () => {
    sandbox.load(editor.value);
});

widthSlider.oninput = function () {
  widthValue.textContent = this.value;
  editor.value = editor.value.replace(/float width = [0-9]*\.[0-9]*/g, `float width = ${this.value}`);
  sandbox.load(editor.value);
}

distanceSlider.oninput = function () {
  distanceValue.textContent = this.value;
  editor.value = editor.value.replace(/float dis = [0-9]*\.[0-9]*/g, `float dis = ${this.value}`);
  sandbox.load(editor.value);
}

blurSlider.oninput = function () {
  blurValue.textContent = this.value;
  editor.value = editor.value.replace(/float blur = [0-9]*\.[0-9]*/g, `float blur = ${this.value}`);
  sandbox.load(editor.value);
}

repetitionSlider.oninput = function () {
  repetitionValue.textContent = this.value;
  editor.value = editor.value.replace(/float rep = [0-9]*\.[0-9]*/g, `float rep = ${this.value}`);
  sandbox.load(editor.value);
}

multiplySlider.oninput = function () {
  multiplyValue.textContent = this.value;
  editor.value = editor.value.replace(/float mul = [0-9]*\.[0-9]*/g, `float mul = ${this.value}`);
  sandbox.load(editor.value);
}

exponentSlider.oninput = function () {
  exponentValue.textContent = this.value;
  editor.value = editor.value.replace(/float ex = [0-9]*/g, `float ex = ${this.value}`);
  sandbox.load(editor.value);
}

pointsSlider.oninput = function () {
  pointsValue.textContent = this.value;
  editor.value = editor.value.replace(/float points = [0-9]*/g, `float points = ${this.value}`);
  sandbox.load(editor.value);
}
}

</script>
